<%# app/views/deliveries/index.html.erb %>
<% month_names = Date::MONTHNAMES %>
<%= turbo_frame_tag 'schedule' do %>
  <!-- <h1 class="mb-6 text-2xl leading-6 text-stone-900">Delivery Schedule</h1> -->
  <div class="lg:grid lg:grid-cols-12 lg:gap-x-16">
    <!-- Calendar Component -->
    <div class="mt-10 text-center lg:col-start-8 lg:col-end-13 lg:row-start-1 lg:mt-9 xl:col-start-9">
      <div class="flex items-center">
        <%= link_to deliveries_path(year: @date.prev_month.year, month: @date.prev_month.month, date: @selected_date), class: "-m-1.5 flex flex-none items-center justify-center p-1.5 text-stone-400 hover:text-stone-500" do %>
          <span class="sr-only">Previous month</span>
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
          </svg>
        <% end %>
        <div class="flex-auto font-bold"><%= month_names[@date.month] %></div>
        <%= link_to deliveries_path(year: @date.next_month.year, month: @date.next_month.month, date: @selected_date), class: "-m-1.5 flex flex-none items-center justify-center p-1.5 text-stone-400 hover:text-stone-500" do %>
          <span class="sr-only">Next month</span>
          <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
          </svg>
        <% end %>
      </div>
      <div class="mt-6 grid grid-cols-7 leading-6 text-stone-500">
        <div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div><div>S</div>
      </div>
      <div class="isolate mt-2 grid grid-cols-7 gap-px bg-stone-200 shadow ring-1 ring-stone-200">
        <!-- Add padding for days before the start of the month -->
        <% start_day = @date.wday %>
        <% (start_day == 0 ? 6 : start_day - 1).times do %>
          <div></div>
        <% end %>
        <!-- Date Buttons -->
        <% (1..Time.days_in_month(@month, @year)).each do |day| %>
          <% current_date = Date.new(@year, @month, day) %>
          <%= link_to deliveries_path(date: current_date), data: { turbo_action: "replace", turbo_frame: "schedule" }, class: "bg-white py-1.5 no-underline hover:bg-stone-100 focus:z-10 #{'text-orange-700 font-semibold' if current_date == @selected_date}", role: "button" do %>
            <time datetime="<%= current_date %>" class="mx-auto flex h-7 w-7 items-center justify-center rounded-full"><%= day %></time>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Order list for selected day -->
    <div class="mt-4 lg:col-span-7 xl:col-span-8">
      <%= turbo_frame_tag 'deliveries_list' do %>
        <section class="min-h-[48rem] px-8 py-6 border border-stone-500/20 shadow-sm">
          <% Rails.logger.debug "Selected Date: #{@selected_date}" %>
          <h2 class="text-lg md:text-xl pb-6 border-b"><%= local_date(@selected_date, format: '%A, %B %-d %Y') %></h2>
          <% if @orders.present? %>
            <ol class="divide-y divide-stone-200 leading-6">
              <%= render partial: 'deliveries/delivery', collection: @orders %>
            </ol>
          <% else %>
            <p class="my-8">No deliveries scheduled for this date.</p>
          <% end %>
        <% end %>
      </section>
    </div>
  </div>
<% end %>
