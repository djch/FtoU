<%# app/views/orders/new.html.erb %>
<div class="max-w-screen-md">
  <header class="my-6 lg:text-lg">
    <h1 class="text-xl">Order Form</h1>
  </header>
</div>

<div class="-mx-4 px-4 py-8 shadow-sm ring-1 ring-stone-400/30 sm:mx-0 sm:px-8 sm:pb-14 lg:col-span-2 lg:row-span-2 lg:row-end-2 xl:px-16 xl:pb-20 xl:pt-16">
  <% @products.each do |product| %>
    <div>
      <%= product.title %> - <%= product.price %> per <%= product.unit %>
      <%= form_tag order_items_path, method: :post, remote: true, data: { turbo_frame: "order-summary" } do %>
        <%= hidden_field_tag :product_id, product.id %>
        Quantity: <%= number_field_tag :quantity, 1, min: 1, class: "form-input" %>
        <%= submit_tag "Add", class: "btn" %>
      <% end %>
    </div>
  <% end %>

  <%= form_with model: @order, local: true do |form| %>

    <%= render 'orders/order_summary', order: @order, order_items: @order_items %>

    <!-- Customer Details -->
    <div class="mt-6">
      <h2 class="text-xl mb-4">Customer Details</h2>

      <div class="my-4">
        <%= form.label :name %>
        <%= form.text_field :name, class: "form-input w-64", required: true %>
      </div>
      <div class="my-4">
        <%= form.label :phone %>
        <%= form.text_field :phone, class: "form-input w-48", required: true %>
      </div>
      <div class="my-4">
        <%= form.label :email %>
        <%= form.text_field :email, class: "form-input w-80" %>
      </div>
      <div class="my-4">
        <%= form.label :delivery_notes %>
        <%= form.text_area :delivery_notes, rows: 5, class: "form-input w-96" %>
      </div>
      <div class="my-4 p-4 bg-stone-100 dark:bg-stone-950 w-96">
        <p class="mb-3">Please provide a delivery address</p>
        <div data-controller="places">
          <%= form.label "Address finder" %>
          <input data-places-target="autocomplete" type="text" placeholder="Enter address" class="form-input w-full bg-white dark:bg-stone-900">
          <input data-places-target="street" type="hidden" name="order[street_address]">
          <input data-places-target="town" type="hidden" name="order[town]">
          <input data-places-target="state" type="hidden" name="order[state]">
          <input data-places-target="postcode" type="hidden" name="order[postcode]">
          <input data-places-target="country" type="hidden" name="order[country]">
        </div>
      </div>

      <%= form.submit "Place Order", class: "btn btn--primary" %>
    </div>
  <% end %>
</div>
